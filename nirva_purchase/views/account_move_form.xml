<odoo>
  <data>

    <!-- Customizations in Account Move Form -->
    <record model="ir.ui.view" id="nirva_account_move_form">
      <field name="name">account_move_form_customizations</field>
      <field name="model">account.move</field>
      <field name="priority">100</field>
      <field name="inherit_id" ref="account.view_move_form" />
      <field name="arch" type="xml">

        <!-- BOTONES INTELIGENTES -->
        <!-- Pagos relacionados -->
        <xpath expr="//form/sheet/div[@class='oe_button_box']/button[1]" position="before">
          <button name="open_account_move_payments" type="object" icon="fa-credit-card"
            class="oe_stat_button">
            <field name="oupp_payments_count" string="Pagos" widget="statinfo" />
          </button>
        </xpath>

        <!-- DATOS DE PAGO -->
        <xpath expr="//form/sheet/group/group[@id='header_left_group']/div[1]" position="before">
          <!-- Empresa -->
          <field name="empresa_id" />
        </xpath>
        <!-- Referencia UUID -->
        <xpath expr="//form/sheet/group/group/label" position="attributes">
          <attribute name="string">Referencia UUID</attribute>
        </xpath>
        <field name="ref" position="after">
          <!-- Regimen fiscal -->
          <field name="oupp_regimen_fiscal" />
          <!-- Factura SAT -->
          <field name="factura_sat" />
        </field>
        <field name="partner_bank_id" position="after">
          <!-- Cuenta bancaria -->
          <field name="oupp_partner_bank_id" />
          <!-- Tipo de pago -->
          <field name="oupp_tipo_de_pago" />
        </field>
        <field name="partner_bank_id" position="replace">
        </field>

        <!-- DATOS DE ORDEN DE COMPRA -->
        <xpath expr="//form/sheet/group[1]" position="after">
          <group string="Datos de Orden de Compra">
            <field name="oupp_po" />
            <field name="oupp_po_ref" />
            <field name="oupp_obra" />
            <field name="oupp_concepto" />
            <field name="oupp_autoriza" />
            <field name="account_analytic_group" />
            <field name="account_analytic_account" domain="[('group_id', '=', account_analytic_group.id)]"/>
          </group>
        </xpath>


      </field>
    </record>

    <!-- Registering actions -->
    <record model="ir.actions.server" id="nirva_actions_set_analytic_account_in_move_lines">
      <field name="name">Establecer cuenta analítica en apuntes analíticos</field>
      <field name="model_id" ref="model_account_move" />
      <field name="binding_model_id" ref="model_account_move" />
      <field name="state">code</field>
      <field name="code">
        action = records.set_account_analytic_account_in_invoice_lines()
      </field>
    </record>

    <record model="ir.actions.server" id="nirva_actions_set_analytic_group_by_location">
      <field name="name">Establecer grupo analítico por contrato</field>
      <field name="model_id" ref="model_account_move" />
      <field name="binding_model_id" ref="model_account_move" />
      <field name="state">code</field>
      <field name="code">
        action = records._set_analytic_group_by_location()
      </field>
    </record>

  </data>
</odoo>